<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tundlikkus ja spetsiifilisus</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo } = React;

    // Generate random points following a normal-ish distribution
    const generatePoints = (mean, spread, count, seed) => {
      const points = [];
      for (let i = 0; i < count; i++) {
        const u1 = ((seed * (i + 1) * 9301 + 49297) % 233280) / 233280;
        const u2 = ((seed * (i + 2) * 9301 + 49297) % 233280) / 233280;
        const z = Math.sqrt(-2 * Math.log(u1 + 0.001)) * Math.cos(2 * Math.PI * u2);
        const x = mean + z * spread;
        const y = 20 + Math.random() * 60;
        points.push({ x: Math.max(0, Math.min(100, x)), y });
      }
      return points;
    };

    function SensitivitySpecificityViz() {
      const [threshold, setThreshold] = useState(50);
      
      const healthyPoints = useMemo(() => generatePoints(35, 12, 40, 42), []);
      const diseasePoints = useMemo(() => generatePoints(65, 12, 40, 73), []);
      
      const metrics = useMemo(() => {
        const TP = diseasePoints.filter(p => p.x >= threshold).length;
        const FN = diseasePoints.filter(p => p.x < threshold).length;
        const TN = healthyPoints.filter(p => p.x < threshold).length;
        const FP = healthyPoints.filter(p => p.x >= threshold).length;
        
        const sensitivity = TP / (TP + FN) || 0;
        const specificity = TN / (TN + FP) || 0;
        const ppv = TP / (TP + FP) || 0;
        const npv = TN / (TN + FN) || 0;
        
        return { TP, FN, TN, FP, sensitivity, specificity, ppv, npv };
      }, [threshold, healthyPoints, diseasePoints]);

      const generateCurve = (mean, spread, maxHeight) => {
        const points = [];
        for (let x = 0; x <= 100; x += 2) {
          const y = maxHeight * Math.exp(-0.5 * Math.pow((x - mean) / spread, 2));
          points.push(`${x * 5},${150 - y}`);
        }
        return points.join(' ');
      };

      const healthyCurve = generateCurve(35, 12, 100);
      const diseaseCurve = generateCurve(65, 12, 100);

      return (
        <div className="min-h-screen bg-slate-900 text-white p-6">
          <h1 className="text-2xl font-bold text-center mb-2">Tundlikkus ja spetsiifilisus</h1>
          <p className="text-slate-400 text-center mb-6">Liiguta l√§vendi liugurit, et n√§ha, kuidas see m√µjutab klassifikatsiooni</p>
          
          <div className="max-w-4xl mx-auto">
            {/* Main visualization */}
            <div className="bg-slate-800 rounded-xl p-4 mb-6">
              <svg viewBox="0 0 520 200" className="w-full">
                {/* Background regions */}
                <rect x={threshold * 5} y="30" width={500 - threshold * 5} height="140" fill="rgba(239, 68, 68, 0.1)" />
                <rect x="0" y="30" width={threshold * 5} height="140" fill="rgba(34, 197, 94, 0.1)" />
                
                {/* Distribution curves */}
                <polyline points={healthyCurve} fill="none" stroke="#22c55e" strokeWidth="2" opacity="0.7" />
                <polyline points={diseaseCurve} fill="none" stroke="#ef4444" strokeWidth="2" opacity="0.7" />
                
                {/* Data points - Healthy */}
                {healthyPoints.map((point, i) => (
                  <circle
                    key={`h-${i}`}
                    cx={point.x * 5}
                    cy={point.y + 50}
                    r="5"
                    fill={point.x < threshold ? "#22c55e" : "#f97316"}
                    stroke={point.x < threshold ? "#166534" : "#c2410c"}
                    strokeWidth="1.5"
                    opacity="0.8"
                  />
                ))}
                
                {/* Data points - Disease */}
                {diseasePoints.map((point, i) => (
                  <rect
                    key={`d-${i}`}
                    x={point.x * 5 - 5}
                    y={point.y + 45}
                    width="10"
                    height="10"
                    fill={point.x >= threshold ? "#ef4444" : "#eab308"}
                    stroke={point.x >= threshold ? "#991b1b" : "#a16207"}
                    strokeWidth="1.5"
                    opacity="0.8"
                    rx="2"
                  />
                ))}
                
                {/* Threshold line */}
                <line x1={threshold * 5} y1="20" x2={threshold * 5} y2="180" stroke="#fff" strokeWidth="3" strokeDasharray="8,4" />
                <circle cx={threshold * 5} cy="20" r="10" fill="#3b82f6" stroke="#fff" strokeWidth="2" />
                
                {/* Labels */}
                <text x={threshold * 5 / 2} y="190" textAnchor="middle" fill="#22c55e" fontSize="12" fontWeight="bold">Ennustatud negatiivne</text>
                <text x={threshold * 5 + (500 - threshold * 5) / 2} y="190" textAnchor="middle" fill="#ef4444" fontSize="12" fontWeight="bold">Ennustatud positiivne</text>
                
                {/* Axis */}
                <line x1="0" y1="170" x2="500" y2="170" stroke="#64748b" strokeWidth="1" />
                <text x="0" y="185" fill="#94a3b8" fontSize="10">Madal</text>
                <text x="500" y="185" fill="#94a3b8" fontSize="10" textAnchor="end">K√µrge</text>
                <text x="250" y="12" fill="#fff" fontSize="11" textAnchor="middle">Testi v√§√§rtus / Biomarkeri tase</text>
              </svg>
              
              {/* Slider */}
              <div className="mt-4 px-2">
                <label className="block text-sm text-slate-400 mb-2">
                  L√§vend: <span className="text-white font-bold">{threshold}</span>
                </label>
                <input
                  type="range"
                  min="10"
                  max="90"
                  value={threshold}
                  onChange={(e) => setThreshold(Number(e.target.value))}
                  className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                />
              </div>
            </div>
            
            {/* Legend */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
              <div className="bg-slate-800 rounded-lg p-3 flex items-center gap-3">
                <div className="w-6 h-6 rounded-full bg-green-500 border-2 border-green-800"></div>
                <div>
                  <div className="text-xs text-slate-400">T√µesed negatiivne (TN)</div>
                  <div className="font-bold text-green-400">{metrics.TN} tervet</div>
                </div>
              </div>
              <div className="bg-slate-800 rounded-lg p-3 flex items-center gap-3">
                <div className="w-6 h-6 rounded bg-red-500 border-2 border-red-800"></div>
                <div>
                  <div className="text-xs text-slate-400">T√µesed positiivne (TP) </div>
                  <div className="font-bold text-red-400">{metrics.TP} haiget</div>
                </div>
              </div>
              <div className="bg-slate-800 rounded-lg p-3 flex items-center gap-3">
                <div className="w-6 h-6 rounded-full bg-orange-500 border-2 border-orange-800"></div>
                <div>
                  <div className="text-xs text-slate-400">Valepositiivne (FP)</div>
                  <div className="font-bold text-orange-400">{metrics.FP} tervet</div>
                </div>
              </div>
              <div className="bg-slate-800 rounded-lg p-3 flex items-center gap-3">
                <div className="w-6 h-6 rounded bg-yellow-500 border-2 border-yellow-800"></div>
                <div>
                  <div className="text-xs text-slate-400">Valenegatiivne (FN)</div>
                  <div className="font-bold text-yellow-400">{metrics.FN} haiget</div>
                </div>
              </div>
            </div>
            
            {/* Metrics */}
            <div className="grid grid-cols-2 gap-4 mb-6">
              <div className="bg-gradient-to-br from-blue-900 to-blue-800 rounded-xl p-5">
                <div className="text-blue-300 text-sm mb-1">Tundlikkus (Sensitivity)</div>
                <div className="text-4xl font-bold mb-2">{(metrics.sensitivity * 100).toFixed(1)}%</div>
                <div className="text-xs text-blue-300 opacity-80">
                  TP / (TP + FN) = {metrics.TP} / ({metrics.TP} + {metrics.FN})
                </div>
                <div className="text-xs text-blue-200 mt-2">
                  "Kui paljud <span className="font-bold">haiged</span> patsiendid tuvastati √µigesti?"
                </div>
              </div>
              <div className="bg-gradient-to-br from-purple-900 to-purple-800 rounded-xl p-5">
                <div className="text-purple-300 text-sm mb-1">Spetsiifilisus (Specificity)</div>
                <div className="text-4xl font-bold mb-2">{(metrics.specificity * 100).toFixed(1)}%</div>
                <div className="text-xs text-purple-300 opacity-80">
                  TN / (TN + FP) = {metrics.TN} / ({metrics.TN} + {metrics.FP})
                </div>
                <div className="text-xs text-purple-200 mt-2">
                  "Kui paljud <span className="font-bold">terved</span> patsiendid tuvastati √µigesti?"
                </div>
              </div>
            </div>
            
            {/* Additional metrics */}
            <div className="grid grid-cols-2 gap-4 mb-6">
              <div className="bg-slate-800 rounded-lg p-4">
                <div className="text-slate-400 text-xs">Positiivne ennustusv√§√§rtus (PPV)</div>
                <div className="text-xl font-bold text-emerald-400">{(metrics.ppv * 100).toFixed(1)}%</div>
                <div className="text-xs text-slate-500">TP / (TP + FP)</div>
              </div>
              <div className="bg-slate-800 rounded-lg p-4">
                <div className="text-slate-400 text-xs">Negatiivne ennustusv√§√§rtus (NPV)</div>
                <div className="text-xl font-bold text-cyan-400">{(metrics.npv * 100).toFixed(1)}%</div>
                <div className="text-xs text-slate-500">TN / (TN + FN)</div>
              </div>
            </div>
            
            {/* Explanation */}
            <div className="bg-slate-800 rounded-xl p-5 text-sm">
              <h3 className="font-bold text-lg mb-3">Kompromissi m√µistmine</h3>
              <div className="grid md:grid-cols-2 gap-4 text-slate-300">
                <div>
                  <p className="mb-2">
                    <span className="text-green-400">‚óè</span> <strong>Ringid</strong> = Terved patsiendid<br/>
                    <span className="text-red-400">‚ñ†</span> <strong>Ruudud</strong> = Haiged patsiendid
                  </p>
                  <p>
                    Liiguta l√§vendit <strong>vasakule</strong> ‚Üí K√µrgem tundlikkus, madalam spetsiifilisus (tuvastatakse rohkem haigeid, kuid tekib rohkem valeh√§ireid)
                  </p>
                </div>
                <div>
                  <p>
                    Liiguta l√§vendit <strong>paremale</strong> ‚Üí Madalam tundlikkus, k√µrgem spetsiifilisus (v√§hem valeh√§ireid, kuid j√§√§b rohkem haigeid m√§rkamata)
                  </p>
                  <p className="mt-2 text-amber-300">
                    üí° Optimaalne l√§vend s√µltub kliinilisest kontekstist ja iga veat√º√ºbi tagaj√§rgedest.
                  </p>
                </div>
              </div>
            </div>
            
            {/* Footer */}
            <div className="text-center text-slate-500 text-xs mt-6">
            E-tervise keskus ¬∑ Tervisetehnoloogiate instituut ¬∑ TalTech
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<SensitivitySpecificityViz />, document.getElementById('root'));
  </script>
</body>
</html>
